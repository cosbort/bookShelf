{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-gray-50 to-white">
    <div class="max-w-4xl mx-auto px-4 py-12">
        <nav class="flex mb-8 text-gray-600" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2">
                <li>
                    <a href="{{ url_for('index') }}" class="hover:text-accent transition-colors">
                        <i class="fas fa-home mr-1"></i>Home
                    </a>
                </li>
                <li class="flex items-center space-x-2">
                    <span class="text-gray-400">/</span>
                    <a href="{{ url_for('book_detail', book_id=book.id) }}" class="hover:text-accent transition-colors">
                        {{ book.title }}
                    </a>
                </li>
                <li class="flex items-center space-x-2">
                    <span class="text-gray-400">/</span>
                    <span class="text-gray-800">Modifica</span>
                </li>
            </ol>
        </nav>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="p-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">
                    <i class="fas fa-edit mr-3 text-accent"></i>Modifica libro
                </h1>

                <form method="POST" enctype="multipart/form-data" class="space-y-8">
                    <!-- Informazioni principali -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <label class="block">
                                <span class="text-gray-700 font-medium">Titolo</span>
                                <input type="text" name="title" value="{{ book.title }}" required
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>

                            <label class="block">
                                <span class="text-gray-700 font-medium">Autore</span>
                                <input type="text" name="author" value="{{ book.author }}" required
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>

                            <label class="block">
                                <span class="text-gray-700 font-medium">ISBN</span>
                                <input type="text" name="isbn" value="{{ book.isbn }}"
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>
                        </div>

                        <div class="space-y-4">
                            <label class="block">
                                <span class="text-gray-700 font-medium">Anno di pubblicazione</span>
                                <input type="number" name="year_published" value="{{ book.year_published }}"
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>

                            <label class="block">
                                <span class="text-gray-700 font-medium">Genere</span>
                                <input type="text" name="genre" value="{{ book.genre }}"
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>

                            <label class="block">
                                <span class="text-gray-700 font-medium">Valutazione</span>
                                <select name="rating" 
                                        class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                                    <option value="">Seleziona una valutazione</option>
                                    {% for i in range(1, 6) %}
                                    <option value="{{ i }}" {% if book.rating == i %}selected{% endif %}>
                                        {{ "★" * i }}{{ "☆" * (5 - i) }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </label>
                        </div>
                    </div>

                    <!-- Stato lettura e date -->
                    <div class="bg-gray-50 rounded-xl p-6 space-y-6">
                        <h3 class="text-lg font-semibold text-gray-800">Stato lettura</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <label class="block">
                                <span class="text-gray-700 font-medium">Stato</span>
                                <select name="reading_status" 
                                        class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                                    <option value="">Seleziona uno stato</option>
                                    <option value="Non iniziato" {% if book.reading_status == 'Non iniziato' %}selected{% endif %}>Non iniziato</option>
                                    <option value="In corso" {% if book.reading_status == 'In corso' %}selected{% endif %}>In corso</option>
                                    <option value="Completato" {% if book.reading_status == 'Completato' %}selected{% endif %}>Completato</option>
                                </select>
                            </label>

                            <label class="block">
                                <span class="text-gray-700 font-medium">Data inizio</span>
                                <input type="date" name="start_date" 
                                       value="{{ book.start_date.strftime('%Y-%m-%d') if book.start_date }}"
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>

                            <label class="block">
                                <span class="text-gray-700 font-medium">Data fine</span>
                                <input type="date" name="end_date" 
                                       value="{{ book.end_date.strftime('%Y-%m-%d') if book.end_date }}"
                                       class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">
                            </label>
                        </div>
                    </div>

                    <!-- Note e immagine -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <label class="block">
                                <span class="text-gray-700 font-medium">Note personali</span>
                                <textarea name="personal_notes" rows="4"
                                          class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50">{{ book.personal_notes }}</textarea>
                            </label>
                        </div>

                        <div class="space-y-4">
                            <label class="block">
                                <span class="text-gray-700 font-medium">Immagine di copertina</span>
                                <input type="file" name="cover_image" accept="image/*"
                                       class="mt-1 block w-full text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent file:text-white hover:file:bg-blue-600">
                            </label>
                            {% if book.cover_image %}
                            <div class="relative group">
                                <img src="{{ url_for('static', filename='images/covers/' + book.cover_image) }}" 
                                     alt="Copertina attuale"
                                     class="w-full h-48 object-cover rounded-lg shadow-sm">
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-opacity duration-300 rounded-lg"></div>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                        <a href="{{ url_for('book_detail', book_id=book.id) }}" 
                           class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Annulla
                        </a>
                        <button type="submit" 
                                class="px-6 py-2 bg-accent text-white rounded-lg hover:bg-blue-600 transition-colors">
                            Salva modifiche
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
